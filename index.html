<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BeaconGen - Survey Beacon Classification System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1e40af',
                        secondary: '#059669',
                        accent: '#dc2626'
                    }
                }
            }
        }
    </script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #1e40af 0%, #059669 100%);
        }
        .card-shadow {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .beacon-code {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #1e40af;
        }
        .animate-pulse-slow {
            animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="bg-white p-2 rounded-lg">
                        <svg class="w-8 h-8 text-primary" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold">BeaconGen</h1>
                        <p class="text-blue-100">Survey Beacon Classification System - Edo State</p>
                    </div>
                </div>
                <div class="text-right">
                    <p class="text-sm text-blue-100">SURCON Compliant</p>
                    <p class="text-xs text-blue-200">Format: SC/ED AA 0001 AZ</p>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Login Section -->
        <div id="loginSection" class="max-w-md mx-auto">
            <div class="bg-white rounded-lg card-shadow p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Surveyor Login</h2>
                <form id="loginForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Login Method</label>
                        <select id="loginMethod" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                            <option value="prefix">Surveyor Prefix (e.g., AZ)</option>
                            <option value="name">Full Name</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Enter Credentials</label>
                        <input type="text" id="loginInput" placeholder="Enter your prefix or name" 
                               class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                    <button type="submit" class="w-full bg-primary text-white py-3 rounded-lg hover:bg-blue-700 transition duration-200">
                        Login
                    </button>
                </form>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboardSection" class="hidden">
            <!-- User Info Card -->
            <div class="bg-white rounded-lg card-shadow p-6 mb-8">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">Welcome, <span id="userName"></span></h2>
                        <p class="text-gray-600">Surveyor Prefix: <span id="userPrefix" class="beacon-code"></span></p>
                    </div>
                    <div class="text-right">
                        <p class="text-sm text-gray-600">Quarterly Quota</p>
                        <p class="text-2xl font-bold text-secondary"><span id="remainingQuota">200</span>/200</p>
                    </div>
                </div>
            </div>

            <!-- System Statistics -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white rounded-lg card-shadow p-6">
                    <div class="flex items-center">
                        <div class="bg-primary p-3 rounded-full">
                            <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                            </svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-gray-600">Total Beacons</p>
                            <p class="text-2xl font-bold text-gray-800" id="totalBeacons">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg card-shadow p-6">
                    <div class="flex items-center">
                        <div class="bg-secondary p-3 rounded-full">
                            <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-gray-600">Active Surveyors</p>
                            <p class="text-2xl font-bold text-gray-800" id="activeSurveyors">5</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg card-shadow p-6">
                    <div class="flex items-center">
                        <div class="bg-accent p-3 rounded-full">
                            <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-gray-600">Current Sequence</p>
                            <p class="text-2xl font-bold text-gray-800 beacon-code" id="currentSequence">AA 0001</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Beacon Generation -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Generation Form -->
                <div class="bg-white rounded-lg card-shadow p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-6">Generate Beacon Codes</h3>
                    <form id="generateForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Number of Beacons</label>
                            <input type="number" id="beaconCount" min="1" max="200" value="1" 
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                            <p class="text-sm text-gray-500 mt-1">Maximum 200 beacons per quarter</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Location/Project Reference (Optional)</label>
                            <input type="text" id="projectRef" placeholder="e.g., Benin City Survey Project" 
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <button type="submit" class="w-full bg-secondary text-white py-3 rounded-lg hover:bg-green-700 transition duration-200">
                            Generate Beacon Codes
                        </button>
                    </form>
                </div>

                <!-- Preview -->
                <div class="bg-white rounded-lg card-shadow p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-6">Generated Codes Preview</h3>
                    <div id="previewArea" class="bg-gray-50 rounded-lg p-4 h-64 overflow-y-auto">
                        <p class="text-gray-500 text-center">Generated beacon codes will appear here...</p>
                    </div>
                    <div class="mt-4 space-y-2">
                        <button id="exportCSV" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition duration-200 disabled:opacity-50" disabled>
                            Export as CSV
                        </button>
                        <button id="exportExcel" class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition duration-200 disabled:opacity-50" disabled>
                            Export as Excel
                        </button>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="bg-white rounded-lg card-shadow p-6 mt-8">
                <h3 class="text-xl font-bold text-gray-800 mb-6">Recent Activity</h3>
                <div id="activityLog" class="space-y-3">
                    <!-- Activity items will be populated here -->
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-6 mt-12">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div>
                    <p class="font-semibold">BeaconGen System</p>
                    <p class="text-sm text-gray-400">SURCON Compliant Survey Beacon Classification</p>
                </div>
                <div class="mt-4 md:mt-0">
                    <p class="text-sm text-gray-400">Developed for Edo State Survey Department</p>
                    <p class="text-xs text-gray-500">© 2025 - Research Project Implementation</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Application State
        let appState = {
            currentUser: null,
            currentSequence: 'AA 0001',
            sequenceNumber: 1,
            totalBeacons: 0,
            generatedCodes: [],
            surveyors: [
                { prefix: 'AZ', name: 'Adebayo Zaccheus', quota: 200 },
                { prefix: 'AW', name: 'Amina Williams', quota: 200 },
                { prefix: 'BX', name: 'Benjamin Xavier', quota: 200 },
                { prefix: 'CY', name: 'Comfort Yusuf', quota: 200 },
                { prefix: 'DV', name: 'Daniel Victor', quota: 200 }
            ],
            activityLog: []
        };

        // DOM Elements
        const loginSection = document.getElementById('loginSection');
        const dashboardSection = document.getElementById('dashboardSection');
        const loginForm = document.getElementById('loginForm');
        const generateForm = document.getElementById('generateForm');
        const previewArea = document.getElementById('previewArea');
        const exportCSV = document.getElementById('exportCSV');
        const exportExcel = document.getElementById('exportExcel');

        // Initialize Application
        function init() {
            loadStoredData();
            setupEventListeners();
            updateUI();
        }

        // Load data from localStorage (simulation)
        function loadStoredData() {
            const stored = localStorage.getItem('beaconGenData');
            if (stored) {
                const data = JSON.parse(stored);
                appState.sequenceNumber = data.sequenceNumber || 1;
                appState.totalBeacons = data.totalBeacons || 0;
                appState.currentSequence = generateSequenceCode(appState.sequenceNumber);
                appState.activityLog = data.activityLog || [];
            }
        }

        // Save data to localStorage
        function saveData() {
            const dataToSave = {
                sequenceNumber: appState.sequenceNumber,
                totalBeacons: appState.totalBeacons,
                activityLog: appState.activityLog
            };
            localStorage.setItem('beaconGenData', JSON.stringify(dataToSave));
        }

        // Setup event listeners
        function setupEventListeners() {
            loginForm.addEventListener('submit', handleLogin);
            generateForm.addEventListener('submit', handleGenerate);
            exportCSV.addEventListener('click', () => exportData('csv'));
            exportExcel.addEventListener('click', () => exportData('excel'));
        }

        // Handle login
        function handleLogin(e) {
            e.preventDefault();
            const method = document.getElementById('loginMethod').value;
            const input = document.getElementById('loginInput').value.trim();
            
            if (!input) {
                alert('Please enter your credentials');
                return;
            }

            let user = null;
            if (method === 'prefix') {
                user = appState.surveyors.find(s => s.prefix.toLowerCase() === input.toLowerCase());
            } else {
                user = appState.surveyors.find(s => s.name.toLowerCase().includes(input.toLowerCase()));
            }

            if (user) {
                appState.currentUser = user;
                loginSection.classList.add('hidden');
                dashboardSection.classList.remove('hidden');
                updateUI();
                addActivity(`${user.name} logged in`);
            } else {
                alert('Invalid credentials. Please check your prefix or name.');
            }
        }

        // Generate sequence code (AA 0001 -> AA 9999 -> AB 0010)
        function generateSequenceCode(number) {
            const firstLetter = Math.floor((number - 1) / 9999);
            const secondLetter = Math.floor(((number - 1) % 9999) / 10);
            const numPart = ((number - 1) % 10) + 1;
            
            if (number <= 9999) {
                return `AA ${String(number).padStart(4, '0')}`;
            } else {
                const first = String.fromCharCode(65 + firstLetter);
                const second = String.fromCharCode(65 + secondLetter);
                const num = numPart === 1 ? 10 : numPart;
                return `${first}${second} ${String(num).padStart(4, '0')}`;
            }
        }

        // Handle beacon generation
        function handleGenerate(e) {
            e.preventDefault();
            const count = parseInt(document.getElementById('beaconCount').value);
            const projectRef = document.getElementById('projectRef').value.trim();
            
            if (count > appState.currentUser.quota) {
                alert(`Insufficient quota. You have ${appState.currentUser.quota} beacons remaining this quarter.`);
                return;
            }

            const codes = [];
            for (let i = 0; i < count; i++) {
                const sequenceCode = generateSequenceCode(appState.sequenceNumber + i);
                const fullCode = `SC/ED ${sequenceCode} ${appState.currentUser.prefix}`;
                codes.push({
                    code: fullCode,
                    sequence: sequenceCode,
                    surveyor: appState.currentUser.name,
                    prefix: appState.currentUser.prefix,
                    project: projectRef,
                    timestamp: new Date().toISOString()
                });
            }

            appState.generatedCodes = codes;
            appState.sequenceNumber += count;
            appState.totalBeacons += count;
            appState.currentUser.quota -= count;
            appState.currentSequence = generateSequenceCode(appState.sequenceNumber);

            displayGeneratedCodes();
            updateUI();
            saveData();
            addActivity(`Generated ${count} beacon codes for ${projectRef || 'general use'}`);
        }

        // Display generated codes
        function displayGeneratedCodes() {
            if (appState.generatedCodes.length === 0) return;

            const html = appState.generatedCodes.map((code, index) => `
                <div class="flex justify-between items-center p-3 bg-white rounded-lg border border-gray-200 mb-2">
                    <span class="beacon-code text-lg">${code.code}</span>
                    <span class="text-sm text-gray-500">#${index + 1}</span>
                </div>
            `).join('');

            previewArea.innerHTML = html;
            exportCSV.disabled = false;
            exportExcel.disabled = false;
        }

        // Export data
        function exportData(format) {
            if (appState.generatedCodes.length === 0) return;

            const data = appState.generatedCodes.map(code => ({
                'Beacon Code': code.code,
                'Sequence': code.sequence,
                'Surveyor': code.surveyor,
                'Prefix': code.prefix,
                'Project': code.project || 'N/A',
                'Generated': new Date(code.timestamp).toLocaleString()
            }));

            if (format === 'csv') {
                const csv = convertToCSV(data);
                downloadFile(csv, 'beacon_codes.csv', 'text/csv');
            } else {
                // For Excel, we'll use CSV format with .xlsx extension
                const csv = convertToCSV(data);
                downloadFile(csv, 'beacon_codes.xlsx', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
            }
        }

        // Convert to CSV
        function convertToCSV(data) {
            const headers = Object.keys(data[0]);
            const csvContent = [
                headers.join(','),
                ...data.map(row => headers.map(header => `"${row[header]}"`).join(','))
            ].join('\n');
            return csvContent;
        }

        // Download file
        function downloadFile(content, filename, type) {
            const blob = new Blob([content], { type });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Add activity log entry
        function addActivity(message) {
            const activity = {
                message,
                timestamp: new Date().toISOString(),
                user: appState.currentUser.name
            };
            appState.activityLog.unshift(activity);
            
            // Keep only last 10 activities
            if (appState.activityLog.length > 10) {
                appState.activityLog = appState.activityLog.slice(0, 10);
            }
            
            updateActivityDisplay();
        }

        // Update activity display
        function updateActivityDisplay() {
            const activityLog = document.getElementById('activityLog');
            if (appState.activityLog.length === 0) {
                activityLog.innerHTML = '<p class="text-gray-500">No recent activity</p>';
                return;
            }

            const html = appState.activityLog.map(activity => `
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                    <span class="text-sm">${activity.message}</span>
                    <span class="text-xs text-gray-500">${new Date(activity.timestamp).toLocaleString()}</span>
                </div>
            `).join('');

            activityLog.innerHTML = html;
        }

        // Update UI
        function updateUI() {
            if (appState.currentUser) {
                document.getElementById('userName').textContent = appState.currentUser.name;
                document.getElementById('userPrefix').textContent = appState.currentUser.prefix;
                document.getElementById('remainingQuota').textContent = appState.currentUser.quota;
            }

            document.getElementById('totalBeacons').textContent = appState.totalBeacons;
            document.getElementById('activeSurveyors').textContent = appState.surveyors.length;
            document.getElementById('currentSequence').textContent = appState.currentSequence;
            
            updateActivityDisplay();
        }

        // Initialize the application
        init();
    </script>
</body>
</html>
